<html lang="en" xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>Transfer</title>
    <link rel="stylesheet" type="text/css" href="/webjars/bootstrap/5.1.3/css/bootstrap.min.css">
    <script src="/webjars/bootstrap/5.1.3/js/bootstrap.bundle.js"></script>
    <link rel="stylesheet" href="/css/stylesheetPerso.css" type="text/css" media="all"/>
</head>
<body>
<!--Principal-->
<div class="container w-100">
        <nav class="navbar navbar-light navbar-expand py-0">
            <div class="container px-0">
                <ul class="nav navbar-nav left py-0">
                    <li>
                        <div class="text-white p-1" style="background-image: linear-gradient(45deg, #0ba29d, #c3ec52)">Pay My Buddy
                        </div>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <a class="nav-link"><span  th:text="${'[Welcome   ' + name_user + ']'}"></span></a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Menu</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" th:href="@{/myProfile}">My Profile</a></li>
                            <li><a class="dropdown-item" th:href="@{/myPayments}">My Payments</a></li>
                            <li><a class="dropdown-item" th:href="@{/myTransfers}">My Transfers Between PMB & My Bank</a></li>
                            <li><a class="dropdown-item" th:href="@{/myBankAccount}">My Bank</a></li>
                            <li><a class="dropdown-item" th:href="@{/addBankAccount}">Add A Bank Account</a></li>
                            <li><a class="dropdown-item" th:href="@{/myConnections}">My connections</a></li>

                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="myContacts">Contact</a>
                    </li>
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <a class="nav-link" th:href="@{/logout}">Logout</a>
                    </li>
                    <li class="nav-item" sec:authorize="hasAuthority('ADMIN')">
                        <a class="nav-link" th:href="@{/admin/addRoleToUser}">Add Role</a>
                    </li>
                </ul>
            </div>
        </nav>
        <nav class="navbar navbar-expand bg-light py-0">
            <div class="container px-0">
                <ul class="nav navbar-nav">
                    <li class="nav-item py-0" sec:authorize="isAuthenticated()">
                        <a class="nav-link py-0 px-2" th:href="@{/home}">Home</a>
                    </li>
                    <p class="nav-link py-0"> / </p>
                    <li class="nav-item py-0">
                        <a class="nav-link py-0" th:href="@{/transfer/pmb-bank}">Transfer-Between-PMB-and-BANK</a>
                    </li>
                </ul>
            </div>
        </nav>
<!--Milieu section send money-->
<div class="card-body w-80 mx-auto">

    <!--Send money and Add Connection-->
    <div class="row justify-content-between mt-3">
        <div class="col">
            Send Money
        </div>
        <div class="col col-md-2" sec:authorize="hasAuthority('USER')">
            <a class="ml-auto btn btn-primary" th:href="@{/addConnection}">
                Add Connection</a>
        </div>
    </div>

    <!--Select-->
    <form sec:authorize="hasAuthority('USER')" method="post" th:action="@{/user/send-money}">

        <div class="row bg-light mx-auto">

            <div>
                <input type="hidden" name="userEmail" th:value="${userEmail}"/>
            </div>
            <div class="col mx-5 mt-5">
                <input class="form-control" type="text" placeholder="description" name="description"th:name="description"/>
            </div>
            <div class="col mt-5 mb-5 mx-5">
                <select class="form-select" aria-label="Default select example" th:name="buddyEmail">
                    <option selected>Select A Connection</option>
                    <option th:each="appUserBuddy:${userBuddyList}" th:text="${appUserBuddy.email}"></option>
                </select>
            </div>
            <div class="input-group col mt-5 mb-5 mx-5">
                <input id="select" class="appUser-select-auto w-50" type="number" name="amount" placeholder="0" th:value="amount" th:text="${amount}"/>
                <span class="input-group-text bg-white bor border-dark border-2">â‚¬</span>
            </div>
            <div class="col mt-5 mb-5 mx-5">
                <button class="btn btn-success px-5" type="submit">Pay</button>
            </div>
        </div>

    </form>

    <!--Table-->
    <div class="mt-3">
        <p class="fw-bold mb-1">My Transaction</p>

        <table class="table table-striped table-hover">
            <thead class="py-5">
            <tr class="bg-success">
                <th>Connections</th>
                <th>Description</th>
                <th>Amount</th>
            </tr>
            </thead>
            <tbody class="py-5">

            <tr th:each="transaction:${transactions}">
                <td th:text="${transaction.getTarget().getFirstName() + ' ' +  transaction.getTarget().getLastName()}" ></td>
                <td th:text="${transaction.description}"></td>
                <td th:text="${#numbers.formatCurrency(transaction.amount)}"></td>
            </tr>

            </tbody>
        </table>
    </div>

    <nav aria-label="Page navigation example" th:if="${totalPage > 1}">
        <ul class="pagination justify-content-center flex-wrap" th:with="pageUrlPrefix='/transfer?page='" >
            <li class="page-item" th:class="${currentPage >= 1 ? 'page-item' : 'page-item disabled'}">
                <a th:href="@{${pageUrlPrefix} + ${currentPage - 1}}" class="page-link" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li th:each="page,status:${pages}">
                <a th:class="${status.index==currentPage?'btn btn-primary':'btn btn-outline-info'}"
                   th:text="${status.index}"
                   th:href="@{transfer(page=${status.index})}"></a>
            </li>
            <li class="page-item" th:class="${currentPage < totalPage - 1 ? 'page-item' : 'page-item disabled'}">
                <a th:href="@{${pageUrlPrefix} + ${currentPage + 1}}" class="page-link" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>

</div>
</div>
</body>
</html>